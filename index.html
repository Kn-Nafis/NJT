<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>For My Valentine ‚ù§Ô∏è</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <!-- Floating hearts background -->
  <div class="hearts" aria-hidden="true">
    <span>‚ù§</span><span>‚ù§</span><span>‚ù§</span><span>‚ù§</span><span>‚ù§</span>
    <span>‚ù§</span><span>‚ù§</span><span>‚ù§</span><span>‚ù§</span><span>‚ù§</span>
  </div>

  <!-- Top nav -->
  <header class="topbar">
    <div class="brand">My Beloved</div>
    <nav class="nav" aria-label="Primary">
      <a href="#story">Our Story</a>
      <a href="#reasons">Reasons</a>
      <a href="#gallery">Gallery</a>
      <a href="#letter">Letter</a>
      <a href="#diary">Diary</a>
    </nav>
    <button class="musicBtn" id="musicBtn" type="button" aria-label="Toggle music">
      ‚ô´
    </button>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="heroOverlay"></div>

    <!-- Replace this image with your best photo -->
    <img class="heroImg" src="g0.jpg" alt="A romantic background" />

    <div class="heroContent">
      <p class="smallTag">A little gift, made with love</p>

      <!-- CHANGE NAME HERE -->
      <h1>Happy Valentine‚Äôs Day, <span class="name">JAAN ‚ù§Ô∏è</span></h1>

      <p class="heroText">
        ONLY YOU ‚Äî because you deserve something special,
        today and every day.
      </p>

      <div class="heroActions">
        <a class="btn primary" href="#letter">Open My Letter</a>
        <a class="btn ghost" href="#gallery">See Our Moments</a>
      </div>

      <div class="countdownCard">
        <div class="countTitle">Our Love Timer</div>
        <div class="countGrid">
          <div class="countBox"><div class="countNum" id="days">0</div><div class="countLbl">Days</div></div>
          <div class="countBox"><div class="countNum" id="hours">0</div><div class="countLbl">Hours</div></div>
          <div class="countBox"><div class="countNum" id="mins">0</div><div class="countLbl">Minutes</div></div>
          <div class="countBox"><div class="countNum" id="secs">0</div><div class="countLbl">Seconds</div></div>
        </div>
        <p class="countHint">Since the day you became my favorite person.</p>
      </div>
    </div>
  </section>

  <!-- Story -->
  <section class="section" id="story">
    <div class="container">
      <h2 class="sectionTitle">Our Story</h2>
      <p class="sectionSub">
        A few moments that I‚Äôll always keep close to my heart.
      </p>

      <div class="timeline">
        <div class="tItem">
          <div class="tDot"></div>
          <div class="tCard">
            <h3>When We First Met</h3>
            <p>
              I still remember the little details ‚Äî your smile, your vibe, the way you made
              everything feel easy.
            </p>
            <span class="tNote">‚ú¶ 2 May 2024, AIUB, Annex 5109</span>
          </div>
        </div>

        <div class="tItem">
          <div class="tDot"></div>
          <div class="tCard">
            <h3>My Favorite Memory</h3>
            <p>
              The day that made me think: ‚ÄúYes‚Ä¶ this is my person.‚Äù
              (You know which one.)
            </p>
            <span class="tNote">‚ú¶ 1st Semester, pre-registration day, when everyone is busy but you took me in your group.</span>
          </div>
        </div>

        <div class="tItem">
          <div class="tDot"></div>
          <div class="tCard">
            <h3>Today</h3>
            <p>
              I choose you ‚Äî again and again. I‚Äôm proud of you, I love you,
              and I‚Äôm grateful for you.
            </p>
            <span class="tNote">‚ú¶ You are everything to me. Just you.</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Reasons -->
  <section class="section soft" id="reasons">
    <div class="container">
      <h2 class="sectionTitle">Reasons I Love You</h2>
      <p class="sectionSub">I do not need any reason to love you‚Ä¶ but here‚Äôs a start.</p>

      <div class="grid3">
        <div class="card">
          <div class="icon">üíó</div>
          <h3>Your Kind Heart</h3>
          <p>You make people feel safe, loved, and seen ‚Äî including me. I feel peace around you.</p>
        </div>

        <div class="card">
          <div class="icon">‚ú®</div>
          <h3>Your Beautiful Energy</h3>
          <p>Everything feels brighter when you‚Äôre around. You cheer me up always.</p>
        </div>

        <div class="card">
          <div class="icon">üåπ</div>
          <h3>The Way You Love</h3>
          <p>Your love is the kind I always prayed for. I learn from you how you love.</p>
        </div>

        <div class="card">
          <div class="icon">ü•∞</div>
          <h3>Your Smile</h3>
          <p>One smile from you and my whole day changes. When I see your smile it hits different.</p>
        </div>

        <div class="card">
          <div class="icon">ü´∂</div>
          <h3>Your Support</h3>
          <p>You believe in me even when I‚Äôm doubting myself. I still remember the IP Lab exam.</p>
        </div>

        <div class="card">
          <div class="icon">üî•</div>
          <h3>Just‚Ä¶ You</h3>
          <p>You are my favorite place to be.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Gallery + Lightbox -->
  <section class="section" id="gallery">
    <div class="container">
      <h2 class="sectionTitle">Our Moments</h2>

      <div class="gallery">
        <figure class="gItem">
          <img src="g1.JPG" alt="Moment 1" data-full="g1.JPG" loading="lazy" decoding="async">
          <figcaption>My favorite smile</figcaption>
        </figure>

        <figure class="gItem">
          <img src="g2.JPG" alt="Moment 2" data-full="g2.JPG" loading="lazy" decoding="async">
          <figcaption>From This</figcaption>
        </figure>

        <figure class="gItem">
          <img src="g3.jpeg" alt="Moment 3" data-full="g3.jpeg" loading="lazy" decoding="async">
          <figcaption>To This</figcaption>
        </figure>

        <figure class="gItem">
          <img src="g7.jpeg" alt="Moment 4" data-full="g7.jpeg" loading="lazy" decoding="async">
          <figcaption>My calm & my chaos</figcaption>
        </figure>

        <figure class="gItem">
          <img src="g5.JPG" alt="Moment 5" data-full="g5.JPG" loading="lazy" decoding="async">
          <figcaption>Softest memories</figcaption>
        </figure>

        <figure class="gItem">
          <img src="g6.JPG" alt="Moment 6" data-full="g6.JPG" loading="lazy" decoding="async">
          <figcaption>My favorite chapter</figcaption>
        </figure>
      </div>

      <div class="polaroidWrap">
        <div class="polaroid">
          <img src="g4.png" alt="Polaroid" loading="lazy" decoding="async" />
          <div class="polaroidText">Always you ‚ù§Ô∏è</div>
        </div>

        <div class="polaroidNote">
          <h3>One promise</h3>
          <p>
            I‚Äôll keep choosing you ‚Äî in the small moments, the hard moments,
            and the happiest moments.
          </p>
          <p class="signature">‚Äî Nafis</p>
        </div>
      </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" aria-hidden="true">
      <div class="lightboxBackdrop" data-close="true"></div>

      <div class="lightboxPanel" role="dialog" aria-modal="true" aria-label="Image viewer">
        <button class="lbBtn lbClose" id="lbClose" type="button" aria-label="Close">‚úï</button>
        <button class="lbBtn lbPrev" id="lbPrev" type="button" aria-label="Previous">‚Äπ</button>

        <img class="lightboxImg" id="lightboxImg" alt="Full image" />

        <button class="lbBtn lbNext" id="lbNext" type="button" aria-label="Next">‚Ä∫</button>
      </div>
    </div>
  </section>

  <!-- Letter -->
  <section class="section soft" id="letter">
    <div class="container">
      <h2 class="sectionTitle">A Letter For You</h2>
      <p class="sectionSub">This part is my heart in words.</p>

      <div class="letterCard">
        <p>My love,</p>

        <p>
          Happy Valentine‚Äôs Day. I just want you to know that you are the best thing
          that has ever happened to me. Your presence feels like peace, your voice
          feels like home, and your love feels like a blessing.
        </p>

        <p>
          Thank you for being you ‚Äî for your patience, your kindness, your cute
          moments, and even the little things you don‚Äôt notice about yourself.
          I notice. I appreciate. I love.
        </p>

        <p>
          I can‚Äôt promise a perfect life, but I can promise a real love ‚Äî
          one that stays, one that listens, one that tries.
        </p>

        <p class="letterEnd">
          Forever yours,<br>
          <span class="hand">Nafis</span>
        </p>

        <button class="btn primary" id="surpriseBtn" type="button">Tap for a Surprise üíù</button>
        <p class="surprise" id="surpriseText" aria-live="polite"></p>
      </div>

      <div class="miniRow">
        <div class="miniCard">
          <h3>In My Opinion üéß</h3>
          <p>This only belongs to you.</p>
          <code class="codeLine">Click Here-></code>
          <a class="btn ghost"
             href="https://www.youtube.com/watch?v=cNGjD0VG4R8&list=RDcNGjD0VG4R8&start_radio=1"
             target="_blank" rel="noreferrer">
            Made for you
          </a>
        </div>

        <div class="miniCard">
          <h3>A Little date plan üïØÔ∏è</h3>
          <ul class="checkList">
            <li>Flowers + a handwritten note</li>
            <li>Your favorite snack</li>
            <li>1 hour walk / tea / coffee with you</li>
            <li>Endless memories ‚ù§Ô∏è</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Diary (Google Drive / Sheet) -->
  <section class="section" id="diary">
    <div class="container">
      <h2 class="sectionTitle">Our Diary</h2>
      <p class="sectionSub">Let's write down our memories together.</p>

      <div class="diaryWrap">
        <div class="diaryCard">
          <label class="diaryLabel" for="diaryText">Today‚Äôs Note</label>
          <textarea id="diaryText" class="diaryText" placeholder="Write today's memory... ‚ù§Ô∏è" rows="6"></textarea>

          <div class="diaryActions">
            <button class="btn primary" id="saveDiaryBtn" type="button">Save Note ‚úçÔ∏è</button>
            <button class="btn ghost" id="refreshDiaryBtn" type="button">Refresh</button>
          </div>

          <p class="diaryHint" id="diaryHint" aria-live="polite"></p>
        </div>

        <div class="diaryListCard">
          <div class="diaryListHeader">
            <h3 class="diaryListTitle">All Notes</h3>
          </div>
          <div class="diaryList" id="diaryList"></div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <p>Made with ‚ù§Ô∏è just for you.</p>
  </footer>

  <!-- Background music -->
  <audio id="bgMusic" loop>
    <source src="music.mp3" type="audio/mpeg" />
  </audio>

  <script>
    // =========================
    // 0) API URL (YOUR WEB APP)
    // =========================
    const DIARY_API_URL = "https://script.google.com/macros/s/AKfycbzC2tBjAXEMNxbcaMfA1xEBOxNcKT6ALmp0B0SqFVFLLbWGCpR1VP9vS0O1M9XUSAgy1g/exec";

    // =========================
    // 1) Love timer
    // =========================
    const loveStart = new Date("2025-01-13T18:11:59Z"); // Dhaka time converted to UTC

    function updateCounter() {
      const now = new Date();
      let diff = Math.max(0, now - loveStart);

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      diff -= days * (1000 * 60 * 60 * 24);

      const hours = Math.floor(diff / (1000 * 60 * 60));
      diff -= hours * (1000 * 60 * 60);

      const mins = Math.floor(diff / (1000 * 60));
      diff -= mins * (1000 * 60);

      const secs = Math.floor(diff / 1000);

      document.getElementById("days").textContent = days;
      document.getElementById("hours").textContent = hours;
      document.getElementById("mins").textContent = mins;
      document.getElementById("secs").textContent = secs;
    }
    updateCounter();
    setInterval(updateCounter, 1000);

    // =========================
    // 2) Surprise button
    // =========================
    const surpriseBtn = document.getElementById("surpriseBtn");
    const surpriseText = document.getElementById("surpriseText");

    const surprises = [
      "You are my favorite person. Always. ‚ù§Ô∏è",
      "If I had to choose again, I‚Äôd still choose you. üíç",
      "You + me = my happiest place. ü•∞",
      "I‚Äôm proud of you. I‚Äôm grateful for you. I love you. üåπ",
      "One day I‚Äôll show you this website and say: ‚ÄòI made it because you‚Äôre my home.‚Äô ü´∂"
    ];

    surpriseBtn.addEventListener("click", () => {
      const msg = surprises[Math.floor(Math.random() * surprises.length)];
      surpriseText.textContent = msg;
      surpriseText.classList.add("show");
    });

    // =========================
    // 3) Music toggle
    // =========================
    const musicBtn = document.getElementById("musicBtn");
    const bgMusic = document.getElementById("bgMusic");
    let musicOn = false;

    musicBtn.addEventListener("click", async () => {
      try {
        if (!musicOn) {
          await bgMusic.play();
          musicOn = true;
          musicBtn.textContent = "‚ùö‚ùö";
          musicBtn.classList.add("on");
        } else {
          bgMusic.pause();
          musicOn = false;
          musicBtn.textContent = "‚ô´";
          musicBtn.classList.remove("on");
        }
      } catch (e) {
        alert("To enable music, add a file named music.mp3 in the same folder as index.html");
      }
    });

    // =========================
    // 4) Gallery Lightbox
    // =========================
    const galleryImgs = Array.from(document.querySelectorAll(".gallery img"));
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightboxImg");
    const lbClose = document.getElementById("lbClose");
    const lbPrev = document.getElementById("lbPrev");
    const lbNext = document.getElementById("lbNext");

    let currentIndex = 0;

    function openLightbox(index){
      currentIndex = index;
      const fullSrc = galleryImgs[currentIndex].dataset.full || galleryImgs[currentIndex].src;
      lightboxImg.src = fullSrc;
      lightbox.classList.add("open");
      lightbox.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }

    function closeLightbox(){
      lightbox.classList.remove("open");
      lightbox.setAttribute("aria-hidden", "true");
      lightboxImg.src = "";
      document.body.style.overflow = "";
    }

    function showPrev(){
      currentIndex = (currentIndex - 1 + galleryImgs.length) % galleryImgs.length;
      openLightbox(currentIndex);
    }

    function showNext(){
      currentIndex = (currentIndex + 1) % galleryImgs.length;
      openLightbox(currentIndex);
    }

    galleryImgs.forEach((img, i) => {
      img.style.cursor = "zoom-in";
      img.addEventListener("click", () => openLightbox(i));
    });

    lbClose.addEventListener("click", closeLightbox);
    lbPrev.addEventListener("click", showPrev);
    lbNext.addEventListener("click", showNext);

    lightbox.addEventListener("click", (e) => {
      if (e.target.dataset.close === "true") closeLightbox();
    });

    document.addEventListener("keydown", (e) => {
      if (!lightbox.classList.contains("open")) return;
      if (e.key === "Escape") closeLightbox();
      if (e.key === "ArrowLeft") showPrev();
      if (e.key === "ArrowRight") showNext();
    });

    // =========================
    // 5) Diary (Google Sheet API)
    // =========================
    const diaryText = document.getElementById("diaryText");
    const saveDiaryBtn = document.getElementById("saveDiaryBtn");
    const refreshDiaryBtn = document.getElementById("refreshDiaryBtn");
    const diaryList = document.getElementById("diaryList");
    const diaryHint = document.getElementById("diaryHint");

    function setHint(msg){
      if (!diaryHint) return;
      diaryHint.textContent = msg || "";
    }

    function escapeHtmlSafe(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function formatDate(iso){
      const d = new Date(iso);
      return d.toLocaleString(undefined, {
        year: "numeric", month: "short", day: "2-digit",
        hour: "2-digit", minute: "2-digit"
      });
    }

    async function apiListNotes(){
      const res = await fetch(`${DIARY_API_URL}?action=list`, { method: "GET" });
      return res.json();
    }

    // ‚úÖ CHANGED: use text/plain to avoid CORS preflight
    async function apiAddNote(text){
      const payload = {
        action: "add",
        text: text.trim()
      };

      const res = await fetch(DIARY_API_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });

      return res.json();
    }

    // ‚úÖ CHANGED: use text/plain to avoid CORS preflight
    async function apiDeleteNote(id){
      const payload = { action: "delete", id };

      const res = await fetch(DIARY_API_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });

      return res.json();
    }

    async function renderDiary(){
      if (!diaryList) return;

      diaryList.innerHTML = `<div class="noteItem"><p class="noteText">Loading‚Ä¶</p></div>`;

      try{
        const data = await apiListNotes();
        if (!data.ok) throw new Error(data.error || "Failed");

        const notes = data.notes || [];
        if (notes.length === 0){
          diaryList.innerHTML = `<div class="noteItem"><p class="noteText">No notes yet. Write your first one ‚ù§Ô∏è</p></div>`;
          return;
        }

        diaryList.innerHTML = notes.map(n => `
          <div class="noteItem" data-id="${escapeHtmlSafe(n.id)}">
            <div class="noteTop">
              <div class="noteDate">${escapeHtmlSafe(formatDate(n.createdAt))}</div>
              <button class="noteDel" type="button" aria-label="Delete note">üóë</button>
            </div>
            <p class="noteText">${escapeHtmlSafe(n.text).replaceAll("\n","<br>")}</p>
          </div>
        `).join("");

        diaryList.querySelectorAll(".noteItem").forEach(item => {
          const id = item.getAttribute("data-id");
          const delBtn = item.querySelector(".noteDel");
          delBtn.addEventListener("click", async () => {
            try{
              setHint("Deleting‚Ä¶");
              const d = await apiDeleteNote(id);
              if (!d.ok) throw new Error(d.error || "Delete failed");
              setHint("Deleted ‚úÖ");
              await renderDiary();
            }catch(err){
              setHint("Delete failed ‚ùå");
            }
          });
        });

      }catch(err){
        diaryList.innerHTML = `<div class="noteItem"><p class="noteText">Failed to load notes. Check API URL / deployment access.</p></div>`;
        setHint("Could not load notes ‚ùå");
      }
    }

    saveDiaryBtn?.addEventListener("click", async () => {
      const text = diaryText.value.trim();
      if (!text){
        setHint("Write something first üòä");
        return;
      }
      try{
        setHint("Saving‚Ä¶");
        const data = await apiAddNote(text);
        if (!data.ok) throw new Error(data.error || "Save failed");
        diaryText.value = "";
        setHint("Saved ‚ù§Ô∏è");
        await renderDiary();
      }catch(err){
        setHint("Save failed ‚ùå");
      }
    });

    refreshDiaryBtn?.addEventListener("click", renderDiary);

    // initial load
    renderDiary();
  </script>
</body>
</html>
